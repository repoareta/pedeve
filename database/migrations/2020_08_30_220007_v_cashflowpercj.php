<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

class VCashflowpercj extends Migration
{
    public function up()
    {
        DB::statement("CREATE VIEW v_cashflowpercj AS
                        	                        	select '1' as status,'01' as urutan,'Iuran MMD' as Jenis,substring(B.THNBLN from 1 for 4) AS TAHUN,substring(B.THNBLN from 5 for 2) AS BULAN,A.CJ,B.DOCNO, A.keterangan,round(A.TOTPRICE*B.Rate) as totpricerp from kasline A,KASDOC B where A.keterangan <> 'PENUTUP' AND B.DOCNO=A.DOCNO AND A.CJ='70' and A.totprice<0 union all select '1' as status,'02' as urutan,'Bunga Deposito' as Jenis,substring(B.THNBLN from 1 for 4) AS TAHUN,substring(B.THNBLN from 5 for 2) AS BULAN,A.CJ,B.DOCNO, A.keterangan,round((A.TOTPRICE*B.Rate)*0.8) as totpricerp from kasline A,KASDOC B where A.keterangan <> 'PENUTUP' AND B.DOCNO=A.DOCNO AND A.CJ='40' and A.totprice<0 union all select '1' as status,'03' as urutan,'Bunga FRN' as Jenis,substring(B.THNBLN from 1 for 4) AS TAHUN,substring(B.THNBLN from 5 for 2) AS BULAN,A.CJ,B.DOCNO, A.keterangan,round(A.TOTPRICE*B.Rate) as totpricerp from kasline A,KASDOC B where A.keterangan <> 'PENUTUP' AND B.DOCNO=A.DOCNO AND A.CJ in ('34','44') and A.totprice<0 union all select '1' as status,'04' as urutan,'Deviden' as Jenis,substring(B.THNBLN from 1 for 4) AS TAHUN,substring(B.THNBLN from 5 for 2) AS BULAN,A.CJ,B.DOCNO, A.keterangan,round(A.TOTPRICE*B.Rate) as totpricerp from kasline A,KASDOC B where A.keterangan <> 'PENUTUP' AND B.DOCNO=A.DOCNO AND A.CJ='48' and A.totprice<0 union all select '1' as status,'05' as urutan,'Investasi Umum' as Jenis,substring(B.THNBLN from 1 for 4) AS TAHUN,substring(B.THNBLN from 5 for 2) AS BULAN,A.CJ,B.DOCNO, A.keterangan,round(A.TOTPRICE*B.Rate) as totpricerp from kasline A,KASDOC B where A.keterangan <> 'PENUTUP' AND B.DOCNO=A.DOCNO AND A.CJ in ('35','45','36','46') and A.totprice<0 union all select '1' as status,'06' as urutan,'Investasi Khusus' as Jenis,substring(B.THNBLN from 1 for 4) AS TAHUN,substring(B.THNBLN from 5 for 2) AS BULAN,A.CJ,B.DOCNO, A.keterangan,round(A.TOTPRICE*B.Rate) as totpricerp from kasline A,KASDOC B where A.keterangan <> 'PENUTUP' AND B.DOCNO=A.DOCNO AND A.CJ in ('15','37','47') union all select '1' as status,'07' as urutan,'Lain-Lain Penerimaan' as Jenis,substring(B.THNBLN from 1 for 4) AS TAHUN,substring(B.THNBLN from 5 for 2) AS BULAN,A.CJ,B.DOCNO, A.keterangan,round(A.TOTPRICE*B.Rate) as totpricerp from kasline A,KASDOC B where A.keterangan <> 'PENUTUP' AND B.DOCNO=A.DOCNO AND A.TOTPRICE<0 and A.CJ='90' union all select '2' as status,'08' as urutan,'Pembayaran MMD' as Jenis,substring(B.THNBLN from 1 for 4) AS TAHUN,substring(B.THNBLN from 5 for 2) AS BULAN,A.CJ,B.DOCNO, A.keterangan,round(A.TOTPRICE*B.Rate) as totpricerp from kasline A,KASDOC B where A.keterangan <> 'PENUTUP' AND B.DOCNO=A.DOCNO AND ((A.CJ in ('71','72') and A.totprice>0) or (A.CJ='61' and A.totprice<0)) union all select '2' as status,'09' as urutan,'Pembiayaan Khusus' as Jenis,substring(B.THNBLN from 1 for 4) AS TAHUN,substring(B.THNBLN from 5 for 2) AS BULAN,A.CJ,B.DOCNO, A.keterangan,round(A.TOTPRICE*B.Rate) as totpricerp from kasline A,KASDOC B where A.keterangan <> 'PENUTUP' AND B.DOCNO=A.DOCNO AND A.CJ='57' and A.totprice>0 union all select '2' as status,'10' as urutan,'Bagi Hasil' as Jenis,substring(B.THNBLN from 1 for 4) AS TAHUN,substring(B.THNBLN from 5 for 2) AS BULAN,A.CJ,B.DOCNO, A.keterangan,round(A.TOTPRICE*B.Rate) as totpricerp from kasline A,KASDOC B where A.keterangan <> 'PENUTUP' AND B.DOCNO=A.DOCNO AND A.CJ='27' and A.totprice>0 union all select '2' as status,'11' as urutan,'Pembiayaan Umum PT AJM' as Jenis,substring(B.THNBLN from 1 for 4) AS TAHUN,substring(B.THNBLN from 5 for 2) AS BULAN,A.CJ,B.DOCNO, A.keterangan,round(A.TOTPRICE*B.Rate) as totpricerp from kasline A,KASDOC B where A.keterangan <> 'PENUTUP' AND B.DOCNO=A.DOCNO AND A.TOTPRICE>0 AND A.CJ in ('35','36') and A.Account='126302' union all select '2' as status,'12' as urutan,'Pembiayaan Umum PT MTT' as Jenis,substring(B.THNBLN from 1 for 4) AS TAHUN,substring(B.THNBLN from 5 for 2) AS BULAN,A.CJ,B.DOCNO, A.keterangan,round(A.TOTPRICE*B.Rate) as totpricerp from kasline A,KASDOC B where A.keterangan <> 'PENUTUP' AND B.DOCNO=A.DOCNO AND A.TOTPRICE>0 AND A.CJ in ('35','36') and A.Account in ('127101','127201') union all select '2' as status,'13' as urutan,'Pembiayaan Umum PT PTC' as Jenis,substring(B.THNBLN from 1 for 4) AS TAHUN,substring(B.THNBLN from 5 for 2) AS BULAN,A.CJ,B.DOCNO, A.keterangan,round(A.TOTPRICE*B.Rate) as totpricerp from kasline A,KASDOC B where A.keterangan <> 'PENUTUP' AND B.DOCNO=A.DOCNO AND A.TOTPRICE>0 AND A.CJ in ('35','36') and A.Account='127103' union all select '2' as status,'14' as urutan,'Pembiayaan Umum PT CTR' as Jenis,substring(B.THNBLN from 1 for 4) AS TAHUN,substring(B.THNBLN from 5 for 2) AS BULAN,A.CJ,B.DOCNO, A.keterangan,round(A.TOTPRICE*B.Rate) as totpricerp from kasline A,KASDOC B where A.keterangan <> 'PENUTUP' AND B.DOCNO=A.DOCNO AND A.TOTPRICE>0 AND A.CJ in ('35','36') and A.Account in ('126126','126215') union all select '2' as status,'15' as urutan,'Biaya Operasional' as Jenis,substring(B.THNBLN from 1 for 4) AS TAHUN,substring(B.THNBLN from 5 for 2) AS BULAN,A.CJ,B.DOCNO, A.keterangan,round(A.TOTPRICE*B.Rate) as totpricerp from kasline A,KASDOC B where A.keterangan <> 'PENUTUP' AND B.DOCNO=A.DOCNO AND A.CJ in ('24','25') union all select '2' as status,'16' as urutan,'Biaya Pajak' as Jenis,substring(B.THNBLN from 1 for 4) AS TAHUN,substring(B.THNBLN from 5 for 2) AS BULAN,A.CJ,B.DOCNO, A.keterangan,round(A.TOTPRICE*B.Rate) as totpricerp from kasline A,KASDOC B where A.keterangan <> 'PENUTUP' AND A.totprice>0 and B.DOCNO=A.DOCNO AND A.CJ in ('65','66','67','68') union all select '2' as status,'17' as urutan,'Penyertaan Saham Langsung' as Jenis,substring(B.THNBLN from 1 for 4) AS TAHUN,substring(B.THNBLN from 5 for 2) AS BULAN,A.CJ,B.DOCNO, A.keterangan,round(A.TOTPRICE*B.Rate) as totpricerp from kasline A,KASDOC B where A.keterangan <> 'PENUTUP' AND A.totprice>0 and B.DOCNO=A.DOCNO AND A.CJ='58' union all select '2' as status,'18' as urutan,'Lain-Lain Pengeluaran' as Jenis,substring(B.THNBLN from 1 for 4) AS TAHUN,substring(B.THNBLN from 5 for 2) AS BULAN,A.CJ,B.DOCNO, A.keterangan,round(A.TOTPRICE*B.Rate) as totpricerp from kasline A,KASDOC B where A.keterangan <> 'PENUTUP' AND A.totprice>0 and B.DOCNO=A.DOCNO AND A.CJ='91'");
    }
    public function down()
    {
        DB::statement("DROP VIEW v_cashflowpercj");
    }
}
